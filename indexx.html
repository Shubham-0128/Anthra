<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Assistant with Avatar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    iframe {
      width: 340px;
      height: 540px;
      border: none;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    #avatarDisplay {
      width: 300px;
      height: 400px;
      border: 2px solid #ddd;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h2>Create Your Avatar</h2>

  <!-- Embed Ready Player Me avatar creator -->
  <iframe
    id="rpmFrame"
    src="https://readyplayer.me/avatar?frameApi"
    allow="camera *; microphone *"
  ></iframe>

  <h3>Your Avatar Preview</h3>
  <iframe
    id="avatarDisplay"
    src=""
    allow="camera *; microphone *"
    hidden
  ></iframe>

  <script>
    const rpmFrame = document.getElementById('rpmFrame');
    const avatarDisplay = document.getElementById('avatarDisplay');

    // Listen to postMessage from Ready Player Me
    window.addEventListener("message", (event) => {
      const json = event.data;

      if (typeof json !== "object") return;
      if (json.source !== "readyplayerme") return;

      // Avatar created
      if (json.eventName === "v1.avatar.exported") {
        const avatarUrl = json.data.url;
        console.log("Avatar URL:", avatarUrl);

        // Show avatar in preview iframe
        avatarDisplay.src = avatarUrl;
        avatarDisplay.hidden = false;

        // Optionally: send to backend via fetch()
      }

      // Resize iframe if needed
      if (json.eventName === "v1.frame.ready") {
        rpmFrame.contentWindow.postMessage(
          JSON.stringify({ target: "readyplayerme", type: "subscribe", eventName: "v1.avatar.exported" }),
          "*"
        );
      }
    });
  </script>
</body>
</html>